# expand-streaming-services-with-deferred-filtering

## Summary
配信サービスの選択肢を拡張し（Netflix、Prime Videoの2つから6つへ）、フィルタリングUIを即時反映方式から「適用/リセット」ボタンを使った遅延反映方式に変更します。

## Motivation
現在の実装では配信サービスがNetflixとPrime Videoの2つのみで、日本で人気のあるHulu、U-NEXT、Disney Plus、Apple TV+などが含まれていません。また、選択肢が増えることでUIが複雑化するため、フィルタリングの適用を明示的に行う「適用ボタン」パターンに移行し、ユーザーが複数の条件を設定してから一度にフィルタリングできるようにします。

### 追加する配信サービス
- **Hulu** (TMDB Provider ID: 15) - 優先度1
- **U-NEXT** (TMDB Provider ID: 84) - 優先度2
- **Disney Plus** (TMDB Provider ID: 337) - 優先度3
- **Apple TV+** (TMDB Provider ID: 350) - 優先度8（TMDB内での表示順位）

### UXの改善
現在のフィルタリングUIは以下のような即時反映方式です：
- チェックボックスを変更すると即座に映画リストが更新される
- ソート順を変更すると即座に映画リストが更新される
- ジャンルフィルターを変更すると即座に映画リストが更新される

この方式では以下の問題があります：
1. 複数の条件を変更したい場合、変更のたびにAPIリクエストが発生する
2. ユーザーが「設定中」と「確定」の区別がつきにくい
3. 選択肢が増えると誤操作による意図しない更新が増える

新しいUIでは：
- すべてのフィルター（配信サービス、ジャンル、ソート順）を変更しても即座には反映されない
- 「適用」ボタンをクリックした時点で、すべての変更が一度に反映される
- 「リセット」ボタンで保存された設定に戻すことができる

## Scope
この変更は `movie-filtering` スペックのみに影響します。

### Affected Capabilities
- **movie-filtering** (MODIFIED): 配信サービスの拡張と、フィルター適用方式の変更

## User-Facing Changes
1. 配信サービスの選択肢が6つに増加（Netflix、Prime Video、Hulu、U-NEXT、Disney Plus、Apple TV+）
2. コントロールパネルに「適用」「リセット」ボタンが追加される
3. フィルター条件を変更しても、「適用」ボタンをクリックするまで映画リストは更新されない
4. 「リセット」ボタンで、現在の一時的な変更を破棄し、保存済みの設定に戻せる

## Implementation Notes
- PROVIDER_IDS定数に4つの新しいサービスを追加
- HTMLに4つの新しいチェックボックスを追加
- 「適用」「リセット」ボタンを追加
- フィルター変更時の即時適用ロジックを削除
- 一時的な状態（pendingState）と確定状態（state）を分離
- localStorage保存は「適用」ボタンクリック時のみ実行

## Dependencies
なし

## Risks
- 既存のlocalStorageデータとの互換性を維持する必要がある
- ユーザーが「適用」ボタンを押し忘れる可能性がある（UIで明示的にガイドする必要がある）
