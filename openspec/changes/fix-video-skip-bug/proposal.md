# Proposal: 動画が勝手にスキップされるバグの修正

## Why

動画再生後、1~3秒程度で勝手にスキップされてどんどん飛ばされてしまう問題が稀に発生しています。これは、YouTubeエラーや状態変化が連続して発生した際に、適切なエラーハンドリングやスキップ防止機構がないために起こっています。

## What Changes

### 現在の問題
1. `handleYoutubeError`がエラー発生時に即座に`playNext()`を呼び出している
2. エラーの種類や原因を判別せずに一律スキップしている
3. 連続してエラーが発生した場合のガード機構がない
4. エラーログが不十分で原因特定が困難

### 修正内容
1. **エラーハンドリングの改善**
   - エラーコードに応じた適切な処理
   - エラーログの詳細化（エラーコード、タイムスタンプ、動画情報）

2. **連続スキップの防止**
   - 最後のスキップから一定時間（例：3秒）以内は自動スキップしない
   - エラーカウンターを導入し、短時間に複数エラーが発生した場合は警告

3. **再試行ロジック**
   - 一部の一時的なエラー（ネットワークエラーなど）は1回リトライ
   - リトライ失敗時のみスキップ

## 影響範囲

- `client/script.js`: エラーハンドリング、スキップ防止ロジックの追加

## 備考

- YouTube Player APIエラーコード: https://developers.google.com/youtube/iframe_api_reference#onError
  - 2: 無効なパラメータ
  - 5: HTML5プレーヤーのエラー
  - 100: 動画が見つからない、非公開
  - 101, 150: 埋め込み再生が許可されていない
